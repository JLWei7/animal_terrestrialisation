# Ancestral Genome reconstruction

We reconstructed the ancestrol genomes and analysed the gene content, including novel, novel core, expanded, contracted and lost homology groups (HGs).

## Novel, novel core and lost HGs

We use [Phylogenetic Aware Parsing Script (PAPS)](https://github.com/PapsLab/Phylogenetic_Aware_Parsing_Script) to infer novel, novel core and lost HGs.

1) It is important to add the 4 letters headers.
2) Run **MCL_row_counter_metazoa.pl**, which generates **Orthogroups_gene_numbers_parsed.txt**
3) Create Input/ folder, put the following three files into this folder:
-  **Orthogroups.txt** (from previous step generated by [Orthofinder2](https://github.com/davidemms/OrthoFinder))
-  **Orthogroups_gene_numbers_parsed.txt**
- A FASTA file containing all the protein sequences of all the genomes.
3) Run **Create_DBs_metazoa.pl**. 
4) Create **PAPS_metazoa.pl** based on our dataset, then run it.

The files in the Input/ folder are too big to upload. Follow the above describing steps, the files could be reproduced.

## Expanded and contracted HGs

We use [CAFE5](https://github.com/hahnlab/CAFE5) to infer gene expansion and contraction. One of the required input is phylogeny tree with branch length, please see **02_phylogeny_inference** for phylogeny inference.

For running [CAFE5](https://github.com/hahnlab/CAFE5), firstly, get the Ultrametric tree using script **expanded_contracted_HGs/scripts/Ultrametic.R**. Then, create lambda files and gene families occupancy table, following [CAFE5](https://github.com/hahnlab/CAFE5) requirement.

`cafe5 -t tree_ultrametric.txt -i filtered_gene_families.txt -p -y lambda.txt -e -o output_p_err > log.txt 2>&1`

CAFE5 was run with Poisson distribution and error model, applying two- and three-lambda models ten times each in order to test convergence of Model Base Final Likelihood (-lnL). We selected highest lnL from two- and three-lambda models to compare their fit using a likelihood ratio test with chi-squared distribution (**expanded_contracted_HGs/scripts/likelihood_ratio.R**)

The selected run results can be found in **expanded_contracted_HGs/results**

We next use [CafePlotter](https://github.com/moshi4/CafePlotter) to analyze changes in gene family size and visualize Expansion/Contraction of gene families on phylogenetic tree. The selected run results can be found in **expanded_contracted_HGs/results/.../result_summary.tsv** and **summary_all_gene_family.svg**