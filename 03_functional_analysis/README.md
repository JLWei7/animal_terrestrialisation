# Biological function analysis

Here are the scripts we used to analyze the biological functions (such as Gene Ontology) of gene contents among terrestrial events, including novel, novel core, lost, expanded and contracted homology groups (HGs). 

## Novel, novel core and lost HGs
After performing [Phylogenetic_Aware_Parsing_Script](https://github.com/PapsLab/Phylogenetic_Aware_Parsing_Script), there are four output files generated. For getting the protein sequences, we need to extract them based on the corresponding headers, which can be found in the output file end with **MCL_genes_IDs.out**. Using the script **03_functional_analysis/scripts/reformat.py** and **seq_extraction_headers_print.py**, the corresponding protein sequences can be extracted to a new FASTA file.

For analyzing biological function and getting GO terms, we use [eggNOG-mapper](http://eggnog-mapper.embl.de/), in which the GO terms can be collected.

For finding the shared (intersected) GO terms among terrestrial nodes, we use script **03_functional_analysis/scripts/intersection_select_all_combination_exclude_rest.py** and **intersection_select_all_combination.py**. The former one is to find intersections of GO terms from specified number of files, excluding others; while the latter one is to find intersections of GO terms from specified number of files,  the intersected GO terns might also present in other TXT files, that is, not excluding.

After getting the intersected GO terms, we extracted the most specific GO terms, that is, the bottom GO terms (in the gene ontology hierarchy). To do this, we use the [goatools](https://github.com/tanghaibao/goatools) library, please see the scripts in **03_functional_analysis/scripts/goatools**. Run **bottom_go_extract.py** to get the bottom GO terms. Run **categorize_go.py** to get the GO terms descriptions and categorize them based on biological_process, cellular_component and molecular_function.

The heatmap of bottom GO terms we described in supplementary figure 4 is generated by **heatmap_compare_event_ancestors_HGcount_number.R**

## Expanded and contracted HGs 

We found the intersected significantly expanded and contracted HGs using **03_functional_analysis/scripts/intersection_select_all_combination_exclude_rest.py** as well, just simply change the list the GO terms to HGs IDs.

For enrichment analysis, we use Bilateria ancestral gene content as background, with Fisher's exact test, analyzing with the script **03_functional_analysis/scripts/enrichment_analysis_fisher.R**

For both GO terms intersection of novel and novel core HGs, and HGs intersection for expanded, contracted and lost HGs, we use library [UpSetR](https://cran.r-project.org/web/packages/UpSetR/vignettes/basic.usage.html) to generate upset diagrams for visualization. 

